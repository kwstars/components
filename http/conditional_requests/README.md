## 目的

条件请求的目的是让客户端携带条件判断信息，服务器在预执行条件验证过程成功后，才返回资源的表述，从而实现网络性能的优化和不必要数据传输的减少。

## 强验证器与弱验证器的概念

验证器（Validator）是 HTTP 协议中用于判断资源是否发生变化的一种机制。验证器可以分为强验证器（Strong Validator）和弱验证器（Weak Validator）。

- **强验证器（Strong Validator）**：强验证器要求资源的任何变化都必须导致验证器的值发生变化。也就是说，如果资源的任何部分（包括实体内容和元数据）发生了变化，那么使用旧的强验证器值的请求将无法通过验证。强验证器通常用于需要精确匹配资源状态的场景，例如资源的更新操作。ETag（Entity Tag）头部就是一种常用的强验证器。

- **弱验证器（Weak Validator）**：弱验证器允许资源的一些微小变化不会导致验证器的值发生变化。也就是说，即使资源发生了一些不重要的变化（例如，改变了资源的格式但没有改变实质内容），使用旧的弱验证器值的请求仍然可以通过验证。弱验证器通常用于不需要精确匹配资源状态的场景，例如资源的缓存验证。在 ETag 头部的值前加上 `W/` 前缀可以创建一个弱验证器。

## 知识点

HTTP 条件请求是一种只在满足特定条件时才会执行的 HTTP 请求。这种请求可以用于优化网络性能，因为它们可以避免不必要的数据传输。以下是一些相关的知识点：

1. **If-Modified-Since**: 这个请求头告诉服务器，只有在资源在指定的日期时间之后被修改过，服务器才应该返回资源。否则，服务器应该返回一个 `304 Not Modified` 响应。

2. **If-Unmodified-Since**: 这个请求头告诉服务器，只有在资源在指定的日期时间之后没有被修改过，服务器才应该返回资源。否则，服务器应该返回一个 `412 Precondition Failed` 响应。

3. **If-Match**: 这个请求头告诉服务器，只有在资源的 ETag 与指定的值匹配，服务器才应该返回资源。否则，服务器应该返回一个 `412 Precondition Failed` 响应。

4. **If-None-Match**: 这个请求头告诉服务器，只有在资源的 ETag 与指定的值不匹配，服务器才应该返回资源。否则，服务器应该返回一个 `304 Not Modified` 响应。

5. **If-Range**: 这个请求头可以与 Range 头部一起使用，告诉服务器，只有在资源的 ETag 或 Last-Modified 与指定的值匹配，服务器才应该返回部分资源。否则，服务器应该返回整个资源。

6. **ETag**: 这个响应头表示资源的一个版本或时间戳，可以用于比较资源的变化。

7. **Last-Modified**: 这个响应头表示资源最后一次被修改的日期时间，可以用于比较资源的变化。

8. **304 Not Modified**: 这个状态码表示资源自上次请求以来没有被修改过，因此客户端可以继续使用其缓存的版本。

9. **412 Precondition Failed**: 这个状态码表示请求的预设条件没有得到满足，因此请求被拒绝。

## 使用场景

1. **缓存验证**：客户端可以使用 `If-None-Match` 或 `If-Modified-Since` 头部来验证其缓存的资源是否仍然是最新的。如果资源没有变化，服务器可以返回 304 状态码，告诉客户端其缓存仍然有效，这样可以避免不必要的数据传输，提高性能。

2. **并发控制**：当多个客户端并行修改同一资源时，可以使用 `If-Match` 或 `If-Unmodified-Since` 头部来确保只有在资源没有被其他客户端修改的情况下，才执行更新操作。这可以防止并发更新导致的数据不一致。

3. **断点续传**：在下载大文件时，如果连接中断，客户端可以在重新连接时使用 `If-Range` 或 `If-Unmodified-Since` 头部，只下载自上次下载以来新增的部分。这可以节省带宽，提高下载速度。

4. **条件获取**：客户端可以使用 `If-Modified-Since` 或 `If-None-Match` 头部，只在资源有更新时获取资源。这可以减少不必要的数据传输，提高性能。

这些场景中，预条件请求都可以提高 Web 性能，提升用户体验，同时保证数据的一致性和完整性。
