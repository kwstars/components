## 简介

RIP 的缺陷

1. **以跳数评估的路由并非最优路径**：RIP 使用跳数作为度量单位，这意味着它并不考虑网络的带宽、延迟或其他可能影响数据传输的因素。因此，RIP 可能会选择一个跳数较少但性能较差的路径，而不是一个跳数较多但性能较好的路径。

2. **最大跳数 15 导致网络规模小**：RIP 协议的最大跳数限制为 15，这限制了 RIP 网络的规模。如果一个网络的直径（即网络中两个最远节点之间的最短路径的跳数）超过 15，那么网络中的一些节点将无法达到。

3. **更新发送全部 RIP 路由表浪费网络资源**：RIP 是一种基于距离向量的路由协议，它通过定期广播整个路由表来更新路由信息。这种方法在大型网络中可能会浪费大量的网络资源。

4. **收敛速度慢**：当网络拓扑发生变化时，RIP 需要一段时间才能适应这种变化，这被称为 "收敛"。RIP 的收敛速度相对较慢，这可能会导致在网络拓扑发生变化后的一段时间内，路由信息不准确。

OSPF（Open Shortest Path First）是一种链路状态路由协议，它基于链路的开销（cost）来选择最优路径。链路的开销可以根据各种因素（如带宽、延迟、可靠性等）来计算。OSPF 的主要特点包括：

1. **链路状态数据库**：每个 OSPF 路由器都维护一个链路状态数据库（LSDB），其中包含了网络中所有链路的状态信息。这些信息是通过链路状态公告（LSA）来交换的。

2. **增量更新**：OSPF 只在网络拓扑发生变化时才发送更新，而且只发送变化的部分。这种增量更新机制可以大大减少网络资源的消耗。

3. **定期刷新**：即使网络拓扑没有发生变化，OSPF 路由器也会每隔 30 分钟向其邻接路由器发送一次 LSDB 的摘要信息。这是为了防止 LSDB 中的信息过时。

4. **分区（Area）**：OSPF 支持将网络划分为多个区域（Area）。每个区域内部运行 OSPF 协议，区域之间通过特殊的路由器（Area Border Router，ABR）来交换路由信息。这种结构可以进一步减少网络资源的消耗，并提高网络的可扩展性。

5. **多路径负载均衡**：如果到达一个目的地有多条等开销的路径，OSPF 可以将流量均匀地分配到这些路径上，从而实现负载均衡。

## OSPF 协议工作过程

OSPF（Open Shortest Path First）协议的工作过程主要包括以下四个步骤：

1. **发现邻居**：OSPF 路由器通过发送 Hello 包来发现邻居。Hello 包是通过 OSPF 的多播地址发送的，因此所有在同一网络段的 OSPF 路由器都能接收到这个包。Hello 包中包含了发送者的 Router ID、当前的 DR 和 BDR、Hello Interval（Hello 包的发送间隔）和 Dead Interval（邻居失效的时间）等信息。

2. **建立邻接关系**：只有建立了邻接关系的邻居路由器才会交换链路状态信息。在多访问网络中，所有的 OSPF 路由器都会与选举出来的设计路由器（DR）和备份设计路由器（BDR）建立邻接关系。在点对点网络中，所有的 OSPF 路由器都会与其邻居建立邻接关系。

3. **传递链路状态信息**：每台 OSPF 路由器都维护一个链路状态数据库（LSDB），其中每一条记录都是一个链路状态公告（LSA）。LSA 描述了链路的状态信息，例如路由器的 ID、直连的网络和对应的开销等。当网络发生变化时，OSPF 路由器会立即向其邻居发送更新的 LSA。在网络稳定（即收敛）后，区域内的所有 OSPF 路由器都会有一个相同的 LSDB。

4. **路由计算**：每当 LSDB 发生变化时，OSPF 路由器都会使用 Dijkstra 算法重新计算到达所有网络的最短路径。这个过程确保了 OSPF 路由器总是能选择最优的路径来转发数据包。

### 报文的类型

OSPF (Open Shortest Path First) 协议有五种类型的报文：

1. **Hello 报文**：用于发现和维护邻居关系。通过定期发送 Hello 报文，路由器可以发现和检测邻居路由器的可达性。
2. **Database Description (DBD) 报文**：在 OSPF 邻居关系建立后，路由器通过发送 DBD 报文来交换路由信息。DBD 报文包含了发送者的 Link State Database (LSDB) 的摘要信息。
3. **Link State Request (LSR) 报文**：如果在接收 DBD 报文后，路由器发现自己的 LSDB 不完整，它会发送 LSR 报文来请求缺失的 Link State Advertisements (LSAs)。
4. **Link State Update (LSU) 报文**：用于响应 LSR 报文，或者在 LSDB 发生变化时更新邻居的 LSDB。LSU 报文包含了一个或多个 LSAs。
5. **Link State Acknowledgment (LSAck) 报文**：用于确认接收到 LSU 报文。当路由器接收到 LSU 报文后，它会发送 LSAck 报文来确认接收。

### 状态类型

OSPF (Open Shortest Path First) 协议在建立邻居关系时，会经历以下七种状态：

1. **Down 状态**：这是 OSPF 邻居关系的初始状态。在这个状态下，路由器还没有收到来自邻居的 Hello 报文。
2. **Attempt 状态**：这个状态只在非广播多接入（Non-Broadcast Multi-Access, NBMA）网络中使用。在这个状态下，路由器正在主动尝试建立邻居关系。
3. **Init 状态**：在这个状态下，路由器已经收到了来自邻居的 Hello 报文，但是收到的 Hello 报文中并没有包含自己的路由器 ID。
4. **2-Way 状态**：在这个状态下，路由器已经收到了来自邻居的 Hello 报文，并且在 Hello 报文中看到了自己的路由器 ID。在点对点网络和广播网络中，路由器在达到这个状态后就会开始选举指定路由器（Designated Router, DR）和备份指定路由器（Backup Designated Router, BDR）。
5. **ExStart 状态**：在这个状态下，路由器已经选举出了 DR 和 BDR，并且开始与 DR 和 BDR 交换链路状态数据库（Link State Database, LSDB）。
6. **Exchange 状态**：在这个状态下，路由器正在与 DR 和 BDR 交换 LSDB。路由器首先发送 Database Description (DBD) 报文，然后等待 DR 和 BDR 的确认。
7. **Full 状态**：在这个状态下，路由器已经与 DR 和 BDR 完全交换了 LSDB。这是 OSPF 邻居关系的最终状态，表示路由器已经学习到了所有的路由信息。

## OSPF 分区域管理

OSPF（Open Shortest Path First）协议支持将网络划分为多个区域（Area），每个区域都有一个唯一的 ID。这种分区域管理的方式有以下几个特点：

1. **邻居关系和链路状态信息交换**：只有在同一个区域内的路由器才会建立邻居关系，并交换链路状态公告（LSA）。收敛后，同一个区域内的所有设备都会有一个相同的链路状态数据库（LSDB）。这个 LSDB 反映了区域内的链路状态，用于计算区域内的路由。

2. **区域边界路由器（ABR）**：不同区域之间的路由信息是由区域边界路由器（Area Border Router，ABR）来转发的。ABR 路由器同时属于两个或多个区域，它会收集各个区域的 LSDB，然后生成一个汇总的 LSA 发送给其他区域。

3. **区域 ID**：每个区域都有一个 32 位的二进制 ID，可以表示为一个十进制数，也可以表示为点分十进制形式。例如，区域 0 等价于区域 0.0.0.0，区域 1 等价于区域 0.0.0.1。

4. **骨干区域（Backbone Area）**：区域 0（或 0.0.0.0）被称为骨干区域。所有非骨干区域间的通信都要通过骨干区域转发。如果网络中有多个 OSPF 区域，那么必须有一个区域是骨干区域。
